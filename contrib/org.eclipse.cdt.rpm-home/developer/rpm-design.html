<html>

<head>
<title>Eclipse-RPM Plug-In Developer's Guide</title>
<link rel="stylesheet" href="http://dev.eclipse.org/viewcvs/index.cgi/%7Echeckout%7E/org.eclipse.cdt-contrib/org.eclipse.cdt.rpm-home/css/main.css?cvsroot=Tools_Project" type="text/css">
</head>

<body>
<h2 align="center">Eclipse-RPM Plug-In Developer's Guide</h2>

<ul>
<li><a href="#classref">Class Reference</a></li>
<ul>
<li><a href="#core">org.eclipse.cdt.rpm.core</a></li>
<li><a href="#ui">org.eclipse.cdt.rpm.ui</a></li>
</ul>
<li><a href="#flaws">Known Flaws/Deficiencies</a></li>
<li><a href="#todo">Possible Features and Enhancements</a></li>
</ul>

<hr>
<a name="classref">
<h2>Class Reference</h2>
<a name="core">
<h3>org.eclipse.cdt.rpm.core</h3>
<p><strong>RPMCore</strong><br>
This class contains a lot of generic methods that handle information gathering
for/about RPM's.
</p>

<p><strong>LinuxShellCmds</strong><br>
This class issues the commands that interact with the shell such as
<code>cp</code>, <code>rpm</code>, <code>rpmbuild</code>, <code>diff</code>.  </p>

<p><strong>RPMExport</strong><br>
This class is called from the GUI to create a binary RPM calling the RPMExportCore (which this class extends) methods with the appropriate parameters.
</p>

<p><strong>SRPMExport</strong><br>
Same as RPMExport except this class creates a source RPM.  This class also extends RPMExportCore.
</p>

<p><strong>RPMExportCore</strong><br>
This class is activated by the RPMExport/SRPMExport classes to actually create the desired RPMs/SRPMs.  This class extends RPMCore.
</p>

<p><strong>SpecFileOps</strong><br>
This class contains methods that operate on RPM spec files.
</p>

<p><strong>TarOps</strong><br>
This class contains methods that operate on tar files.
</p>

<p><strong>SRPMImport</strong><br>
This class is called from the GUI to perform the work of importing a source RPM into an Eclipse C project.  This class extends RPMCore.
</p>

<a name="ui">
<h3>org.eclipse.cdt.rpm.ui</h3>

<p><strong>RPMLogViewer</strong><br>
This class extends the org.eclipse.ui.views class.  It activates the LogReader to show a view of the latest RPM build log.
</p>

<p><strong>LogReader</strong><br>
Activated by the above class to read the latest log generated by the user in the /var/tmp directory.  The name of the log to read is kept in a file in /var/tmp unique for each user.
</p>

<p><strong>RPMPluginPreferencesPage</strong><br>
This class extends the org.eclipse.ui.preferencesPages class.  It allows the user to enter data to be used by the RPM Plugin.
</p>

<p><strong>SRPMImportWizard</strong><br>
Entry point for the SRPM import wizard. This defines the implementation of the contribution to extension point
org.eclipse.ui.importWizards (which is defined in the plugin.xml). It
extends abstract class Wizard  and implements interface IImportWizard.
</p>
<p>This class is so small, there is not too much to do here. The class
should be renamed to SRPMImportWizard (a minor refactoring). The OSGI utility functions should probably added as well. The finish function has been divorced and implemented into the SRPMExportPage.</p>

<p><strong>SRPMImportOperation</strong><br>
Implements IRunnableWithProgress, and is the engine of the import. This is the class that basically calls all the
utility methods in the rpm core plug-in for the import.
</p>
<p>As a side note, this class used to be a lot more complex; it used to
call all the minutiae calls for rpm. It was later decided that the calls
needed to build an SRPM from the ui import should not be part of the UI itself, but rather a wrapper class in the core. And so we moved the
majority of this logic to the core. I'm beginning to think this was a
mistake, and that we should reimplement the logic back here.</p>
<p>This needs to implement Cancel support, and better feedback from the
core on the current step of the import (via the status bar). Right now,
the status bar just reflects the beginning and end of the core based
import. The wrapper function for import in the core needs to listen for
cancel events, and perform any cleanup when  a cancel is issued.</p>

<p><strong>SRPMImportPage</strong><br>
Extends WizardPage implements Listener. This is the first and only page of SRPM import. It defines the combo box SRPM name, the project list to import too, and the build options composite.  The Project list-box needs to filter out projects based on their nature.  Basically, this is being fixed right now, with something like:
<pre>
	IProjectNature cNature =cProject.getNature(CProjectNature.C_NATURE_ID);
	if (cNature!=null)
		projectList.add(internalProjectList[a].getName());
</pre>
</p>
<p>Arguably as Project list is used in both export and import, it should
really belong to its own class, that takes a composite as an argument,
and returns a composite with the project list inserted into it. It should also take an argument for the default project selected, which should be ascertained from the current project selected in the Project Explorer View.</p>
<p>Hot Validation is handled via handleEvent calls and attached listeners.
Basically each handle even calls canFinish(). We should change this to
be less demanding (ie there is not reason to call canFinish on a keystroke event). Would require minor rework on handleEvent.</p>

<p><strong>RPMExportWizard</strong><br>
Entry point for the S/RPM export wizard. This defines the implementation of the contribution to extension point
org.eclipse.ui.exportWizards. It extends abstract class Wizard and
implements interface IExportWizard. The OSGI utility functions should
probably bew added as well. The finish function has been divorced and implemented into the SRPMExportPage.
</p>

<p><strong>RPMExportOperation</strong><br>
Implements IRunnableWithProgress, and is the engine of the export. This is the class that basically calls all the
utility methods in the rpm core plug-in for the export.</p>
<p>As a side note, this class used to be a lot more complex; it used to
call all the minutiae calls for rpm. It was later decided that the calls
needed to build an rpm from the ui export should not be part of the UI
itself, but rather a wrapper class in the core. And so we moved the
majority of this logic to the core. See SRPMImportOperation for bringing wrapper logic back here.</p>

<p><strong>RPMExportPage</strong><br>
Extends WizardPage implements Listener. This is the first page of the RPM Export. It populates the project list selection box, the spec file combo field, version and release and composite export type widgets. (See SRPMImport Page for Project List discussion).
</p>

<p><strong>RPMExportPage_2</strong><br>
Extends WizardPage implements Listener. This is the second page of the RPM Export and is conditional on the state of the project. If any changes have been made (a checksum is calculated and stored in .srpminfo), then the next button is enabled, the finish button is disabled on page 1, and the user must move to page 2 to continue export. This page defines the Patch Tag, ChangeLog Date Stamp, and ChangeLog comment fields. The Patch Tag has to be unique, the ChangeLog Date Stamp has to be legal, and the ChangeLog comment has to be populated to continue.</p>
<p>We really need to formalize the Next/Finish logic, as has become a
twisted mess that has dependencies on the state of the project (is the
checksum right), whether the corresponding ui elements are correct.
Problems arise when you click Back and the second page is invalid and so on.</p>

<a name="flaws">
<h2>Known Flaws/Deficiencies</h2>
<ol>
<li>The first acknowledged flaw/deficiency is that there are currently no Java bindings for the interface into the rpm/rpmbuild commands.  Because of this, these commands are executed by shelling out to the user's current shell and actually executing the rpm/rpmbuild commands.</li>
<li>The second acknowledged flaw/deficiency is the use of the cp command to copy directory structures around.  This is because Java (at least up through 1.4) does not preserve the permissions bits and modification times on files.  These two pieces of information are crucial to RPM package maintainers.  Note:  A Java method (copyDirTree) was written to copy directory trees around, but is not being used until this issue is resolved (maybe 1.5 will resolve this? No, apparently not, at least not in any of the docs I have found in the java.sun.com website).
</li>
<li>Some of the forced inheritance relationships in the core need to be cleaned up.</li>
</ol>

<a name="todo">
<h2>Possible Features/Enhancements</h2>
<ol>
<li>Properties Page Enhancements for source/binary RPMs:
 Each file has a Properties Page associated with it and is gotten to
 by left-clicking on it and selecting Properties.  For RPM's several
 interesting possibilities could be added to the left-hand column that the user
 could click on that would give information about an RPM.  Any information that
 can be retrieved via an rpm -qp command such as version number, release
 number, description,list of files delivered by this S/RPM etc, etc.
</li>
<li>Do not allow users to delete the latest source RPM
For the user to be able to export a source/binary RPM from a previously
imported RPM, the most current source RPM is used as a comparison to generate a
patch with the diff command.  Currently, the user is allowed to
delete that from their project with no warning.  There should be some way to
warn the user before deleting. (a ResourceListener maybe?)
</li>
<li>Allow developers to export source RPM's without patches
Some package maintainers would rather generate a source RPM without generating patches, the current version of the RPM plugin does not allow that.  A button could be added to tell the RPM plugin not to generate patches when creating a source RPM.</li>
<li>Integrate more closely with the Managed Make in the CDT.
Currently, the user is only allowed to import source RPM's into a Standard
Make C/Standard Make C++ project.  The RPM plugin should work with the new
Managed Make C/C++ projects supported in the CDT.
</li>
<li>Java bindings for rpm/rpmbuild</li>
<li>Remove the uses of shell commands when permission bits/modification times are handled properly by Java (work is currently being done on this problem)</li>
<li>Modify RPM Log Viewer to be able to view any selected logs, not just the last one</li>
<li>Add more user-enterable fields to the Preferences Page to make the RPM Plugin more flexible. (work is currently being done on this problem)</li>
<li>A common FileOps interface could be extracted from TarOps and SpecFileOps to create a common access procedure to RPM file resources.</li>
<li>SPEC File Wizard. Just to generate a basic structure should not be to difficult. Getting into more fundamentals of the content of a SPEC would be quite difficult. We could do just as Emacs does and generate a non interactive skeleton.</li>
<li>SPEC File Editor. For generating basic syntax highlighting, and maybe some sort of command completion should not be very difficult. I don't think SPEC files have a DOM so I'm not sure we can implement syntax checking. We could Syntax check the shell based sections maybe.</li>
<li>Refactoring should be done to remove forced inheritance relationships from the core.</li>
</ol>

</body>
</html>
